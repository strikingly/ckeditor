/*
 Copyright (c) 2003-2015, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.md or http://ckeditor.com/license
*/
(function(){CKEDITOR.dialog.add("link",function(e){var g=CKEDITOR.plugins.link,h=e.lang.common,c=e.lang.link;return{title:c.title,minWidth:350,minHeight:110,resizable:CKEDITOR.DIALOG_RESIZE_NONE,buttons:[CKEDITOR.dialog.removeButton,CKEDITOR.dialog.okButton],contents:[{id:"info",label:c.info,title:c.info,elements:[{id:"linkType",type:"radio","default":"url",className:"cke_dialog_link_type",items:[[c.toWeb,"url"],[c.toEmail,"email"],[c.toDocument,"document"]],onChange:function(){var a=this.getDialog(),
b=["urlOptions","emailOptions","documentOptions"],f=this.getValue(),d=a.definition.getContents("upload"),d=d&&d.hidden;"url"==f?(e.config.linkShowTargetTab&&a.showPage("target"),d||a.showPage("upload")):(a.hidePage("target"),d||a.hidePage("upload"));for(d=0;d<b.length;d++){var c=a.getContentElement("info",b[d]);c&&(c=c.getElement().getParent().getParent(),b[d]==f+"Options"?c.show():c.hide())}a.layout()},setup:function(a){this.setValue(a.type||"url")},commit:function(a){a.type=this.getValue()}},{type:"vbox",
id:"urlOptions",className:"cke_dialog_web",children:[{type:"text",id:"url",label:c.url,labelLayout:"horizontal",className:"cke_dialog_url",widths:["70px"],onLoad:function(){this.getInputElement().setAttribute("placeholder",c.urlPlaceholder)},validate:function(){var a=this.getDialog();if(a.getContentElement("info","linkType")&&"url"!=a.getValueOf("info","linkType"))return!0;if(!e.config.linkJavaScriptLinksAllowed&&/javascript\:/.test(this.getValue()))return alert(h.invalidValue),!1;if(this.getDialog().fakeObj)return!0},
setup:function(a){this.allowOnChange=!1;a.web?this.setValue(a.web.url):this.setValue("");this.allowOnChange=!0},onKeyUp:function(){this.onChange()},onChange:function(){var a=this.getValue(),b=this.getDialog().getContentElement("info","linkTargetType");/^#/.test(a)?b.disable():b.enable()},commit:function(a){a.web||(a.web={});a.web.url=this.getValue();this.allowOnChange=!1}},{type:"checkbox",id:"linkTargetType",label:c.openInNewTab,className:"cke_dialog_new_tab",setup:function(a){a.web&&this.setValue(a.web.openInNewTab)},
commit:function(a){a.web||(a.web={});a.web.openInNewTab=!!this.getValue()}}]},{type:"text",id:"emailOptions",label:c.emailAddress,labelLayout:"horizontal",widths:["70px"],className:"cke_dialog_email",onLoad:function(){this.getInputElement().setAttribute("placeholder",c.emailPlaceholder)},validate:function(){var a=this.getDialog();if(!a.getContentElement("info","linkType")||"email"!=a.getValueOf("info","linkType"))return!0;if(!/.+@.+\..+/.test(this.getValue()))return alert(c.invalidEmail),!1},setup:function(a){var b=
this.getDialog().getContentElement("info","linkType");b||this.getElement().hide();a.email&&this.setValue(a.email.address);b&&"email"==b.getValue()&&this.select()},commit:function(a){a.email||(a.email={});a.email.address=this.getValue()}},{type:"vbox",id:"documentOptions",children:[{type:"hbox",widths:["10px"],children:[{type:"button",id:"upload",label:c.upload,className:"cke_dialog_upload",onLoad:function(){var a=this.getElement().getChild([0]),b=a.getHtml();a.setHtml('<i class="entypo-upload"></i> '+
b)},onClick:function(){var a=this.getDialog();e.config.uploadCallback(function(b){a.getContentElement("info","uploadUrl").setValue(b||"")})}},{type:"text",id:"uploadUrl",className:"cke_dialog_upload_url",onLoad:function(){this.getInputElement().setAttribute("readonly","readonly")},setup:function(a){a.document?this.setValue(a.document.url):this.setValue("")},onChange:function(){var a=this.getValue(a),b=this.getDialog().getContentElement("info","uploadLinkTargetType");this.getElement()[a?"show":"hide"]();
b.getElement()[a?"show":"hide"]()},commit:function(a){a.document||(a.document={});a.document.url=this.getValue()}}]},{type:"checkbox",id:"uploadLinkTargetType",label:c.openInNewTab,className:"cke_dialog_new_tab",setup:function(a){a.document&&this.setValue(a.document.openInNewTab)},commit:function(a){a.document||(a.document={});a.document.openInNewTab=this.getValue()}}]}]}],onShow:function(){var a=this.getParentEditor(),b=a.getSelection(),f=null;(f=g.getSelectedLink(a))&&f.hasAttribute("href")?b.getSelectedElement()||
b.selectElement(f):f=null;var a=g.parseLinkAttributes(a,f),b=!1,d=c.removeLink;switch(a.type){case "email":a.email.address?d=c.removeEmail:b=!0;break;case "url":a.web.url||(b=!0);break;case "document":a.document.url?d=c.removeDocument:b=!0;break;default:b=!0}var e=this.getButton("remove").getElement();b?e.hide():(e.getChild([0]).setText(d),e.show());this._.selectedElement=f;this.setupContent(a)},onOk:function(){var a={};this.commitContent(a);var b=e.getSelection(),c=g.getLinkAttributes(e,a),d="document"===
a.type&&a.document.openInNewTab;c.set.target="url"===a.type&&a.web.openInNewTab||d?"_blank":"_self";if("email"===a.type&&!a.email.address||"url"===a.type&&!a.web.url||"document"===a.type&&!a.document.url)e.execCommand("unlink");else if(this._.selectedElement){var d=this._.selectedElement,h=d.data("cke-saved-href"),i=d.getHtml();d.setAttributes(c.set);d.removeAttributes(c.removed);if(h==i||"email"==a.type&&-1!=i.indexOf("@"))d.setHtml("email"==a.type?a.email.address:c.set["data-cke-saved-href"]),b.selectElement(d);
delete this._.selectedElement}else b=b.getRanges()[0],b.collapsed&&(a=new CKEDITOR.dom.text("email"==a.type?a.email.address:c.set["data-cke-saved-href"],e.document),b.insertNode(a),b.selectNodeContents(a)),c=new CKEDITOR.style({element:"a",attributes:c.set}),c.type=CKEDITOR.STYLE_INLINE,c.applyToRange(b,e),b.select()},onRemove:function(){e.execCommand("unlink")},onFocus:function(){var a=this.getContentElement("info","linkType");a&&"url"==a.getValue()&&(a=this.getContentElement("info","url"),a.select())}}})})();